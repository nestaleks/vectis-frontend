<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test Navigation - Vectis POS</title>
    <link rel="stylesheet" href="./styles/main.css">
    <style>
        body {
            margin: 0;
            font-family: -apple-system, BlinkMacSystemFont, sans-serif;
        }
        .debug-panel {
            position: fixed;
            top: 10px;
            right: 10px;
            background: #333;
            color: white;
            padding: 10px;
            border-radius: 6px;
            font-size: 12px;
            max-width: 300px;
            z-index: 10000;
        }
        .debug-log {
            margin: 2px 0;
        }
    </style>
</head>
<body>
    <!-- Debug Panel -->
    <div id="debug-panel" class="debug-panel">
        <div><strong>Debug Log:</strong></div>
        <div id="debug-log"></div>
    </div>

    <!-- Loading Screen -->
    <div id="loading" class="loading-screen">
        <div class="logo">üõí</div>
        <h1 class="app-name">Vectis</h1>
        <p class="app-tagline">Testing Navigation</p>
        <div class="loading-spinner"></div>
    </div>
    
    <!-- Main Application -->
    <div id="app"></div>

    <script type="module">
        // Debug logging
        function debugLog(message) {
            const debugElement = document.getElementById('debug-log');
            const logEntry = document.createElement('div');
            logEntry.className = 'debug-log';
            logEntry.textContent = `${new Date().toLocaleTimeString()}: ${message}`;
            debugElement.appendChild(logEntry);
            console.log(`[DEBUG] ${message}`);
            
            // Keep only last 10 entries
            const logs = debugElement.children;
            if (logs.length > 10) {
                debugElement.removeChild(logs[0]);
            }
        }

        // Override console.log to show in debug panel
        const originalLog = console.log;
        console.log = function(...args) {
            originalLog.apply(console, args);
            debugLog(args.join(' '));
        };

        async function initializeApp() {
            try {
                debugLog('üöÄ Starting Vectis POS System...');
                
                // Import and initialize the app manager
                const { default: AppManager } = await import('./core/app-manager.js');
                const app = new AppManager();
                
                debugLog('üì± AppManager created');
                
                // Initialize the application
                await app.init();
                
                debugLog('‚úÖ App initialization completed');
                
                // Hide loading screen
                setTimeout(() => {
                    const loading = document.getElementById('loading');
                    loading.style.display = 'none';
                    debugLog('üé® Loading screen hidden');
                }, 1000);
                
            } catch (error) {
                console.error('‚ùå Failed to initialize Vectis POS System:', error);
                debugLog(`‚ùå Error: ${error.message}`);
                
                // Show error
                document.getElementById('loading').innerHTML = `
                    <div style="text-align: center; padding: 40px; color: red;">
                        <h2>Error</h2>
                        <p>${error.message}</p>
                        <button onclick="window.location.reload()">Retry</button>
                    </div>
                `;
            }
        }
        
        // Start the application
        document.addEventListener('DOMContentLoaded', initializeApp);
        
        // Global error handling
        window.addEventListener('error', (event) => {
            debugLog(`üí• Global error: ${event.error?.message || event.message}`);
        });
        
        // Unhandled promise rejection handling
        window.addEventListener('unhandledrejection', (event) => {
            debugLog(`üö® Unhandled promise rejection: ${event.reason}`);
        });
        
        // Test button clicking manually
        window.testNewOrderButton = function() {
            debugLog('üß™ Testing New Order button manually');
            const button = document.querySelector('[data-action="new-order"]');
            if (button) {
                debugLog('‚úÖ Found New Order button');
                button.click();
                debugLog('üëÜ Clicked New Order button');
            } else {
                debugLog('‚ùå New Order button not found');
            }
        };
        
        // Expose for debugging
        window.debugLog = debugLog;
    </script>
</body>
</html>